"use strict";(self.__VM_WPK_C_LR__m=self.__VM_WPK_C_LR__m||[]).push([[99582],{2901:(e,r,n)=>{n.r(r),n.d(r,{adapter:()=>b});var t=n(64467),i=n(80045),o=n(90740),d=n(70433),a=n(63013),u=n(98936),s=n(67436),p=n(55074),c=["bids","bidderRequestId","bidderCode"];function f(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,t)}return n}function l(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?f(Object(n),!0).forEach(function(r){(0,t.A)(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var b={code:"unruly",supportedMediaTypes:[p.G_,p.D4],gvlid:36,isBidRequestValid:function(e){var r=(0,d.A)(e,"params.siteId")&&function(e){var r=(0,d.A)(e,"mediaTypes.video"),n=(0,d.A)(e,"mediaTypes.banner"),t=!(!r&&!n);return t&&r&&(t=function(e){return!!e.context&&-1!==["outstream","instream"].indexOf(e.context)}(r)),t&&n&&(t=function(e){return e.sizes}(n)),t}(e);return!!r},buildRequests:function(e,r){var n,t="https://targeting.unrulymedia.com/unruly_prebid";return e[0]&&(t=(0,d.A)(e[0],"params.endpoint")||t),function(e,r,n){n.bids,n.bidderRequestId,n.bidderCode;var t=(0,i.A)(n,c),o=n.bids.length-r.length,a={};r.forEach(function(r){var n=r.params.siteId;!function(e){Object.keys(e.mediaTypes).forEach(function(r){var n,t;n="function"==typeof e.getFloor?(null===(t=e.getFloor({currency:"USD",mediaType:r,size:"*"}))||void 0===t?void 0:t.floor)||0:e.params.floor||0,e.mediaTypes[r].floor=n})}(r),function(e){var r=(0,d.A)(e,"mediaTypes.banner");if(r){var n={},t=[];r.sizes.forEach(function(e){n[e.toString()]||(n[e.toString()]=!0,t.push(e))}),r.sizes=t}}(r),function(e,r){!r&&e.ortb2Imp&&e.ortb2Imp.ext&&delete e.ortb2Imp.ext.ae}(r,e.protectedAudienceEnabled),a[n]=a[n]||[],a[n].push(r)});var u=[];return Object.keys(a).forEach(function(r){var n={bidderRequest:Object.assign({},l({bids:a[r],invalidBidsCount:o,prebidVersion:"9.53.2"},t))};u.push(Object.assign({},l({data:n},e)))}),u}({url:t,method:"POST",options:{contentType:"application/json"},protectedAudienceEnabled:null===(n=r.paapi)||void 0===n?void 0:n.enabled},e,r)},interpretResponse:function(e){if(!e||!e.body||!e.body.auctionConfigs&&!e.body.bids)return[];var r=e.body,n=[],t=null;if(r.bids.length&&(n=function(e){var r=[];return e.forEach(function(e){var n,t=(0,d.A)(e,"meta.mediaType");if(t&&"banner"===t.toLowerCase())e.mediaType=p.D4,n=function(e){if(e.ad)return e;(0,a.logError)(new Error("UnrulyBidAdapter: Missing ad config."))}(e);else if(t&&"video"===t.toLowerCase()){var i=(0,d.A)(e,"meta.videoContext");e.mediaType=p.G_,"instream"===i?n=function(e){if(e.vastUrl||e.vastXml)return e;(0,a.logError)(new Error("UnrulyBidAdapter: Missing vastUrl or vastXml config."))}(e):"outstream"===i&&(n=function(e){var r=!!(0,d.A)(e,"ext.renderer.config"),n=!!(0,d.A)(e,"ext.renderer.config.siteId");if(r){if(n){var t=(0,d.A)(e,"ext.renderer");!function(e,r){if(!e.config)throw new Error("UnrulyBidAdapter: Missing renderer config.");if(!e.config.siteId)throw new Error("UnrulyBidAdapter: Missing renderer siteId.");parent.window.unruly=parent.window.unruly||{},parent.window.unruly.native=parent.window.unruly.native||{},parent.window.unruly.native.siteId=parent.window.unruly.native.siteId||e.config.siteId,parent.window.unruly.native.adSlotId=r,parent.window.unruly.native.supplyMode="prebid"}(t,e.requestId),parent.window.unruly.native.prebid=parent.window.unruly.native.prebid||{},parent.window.unruly.native.prebid.uq=parent.window.unruly.native.prebid.uq||[];var i=u.A4.install(Object.assign({},t)),o=Object.assign({},e,{renderer:i,adUnitCode:(0,d.A)(e,"ext.adUnitCode")});return i.setRender(function(){var e;e=o,parent.window.unruly.native.prebid.uq.push(["render",e])}),e.renderer=e.renderer||i,e}(0,a.logError)(new Error("UnrulyBidAdapter: Missing renderer siteId."))}else(0,a.logError)(new Error("UnrulyBidAdapter: Missing renderer config."))}(e))}n&&r.push(n)}),r}(r.bids)),r.auctionConfigs){var i=r.auctionConfigs,o=Object.keys(i);o.length&&o.forEach(function(e){t=[{bidId:e,config:i[e]}]})}return t?{bids:n,paapi:t}:n}};(0,s.a$)(b),(0,o.E)("unrulyBidAdapter")}}]);